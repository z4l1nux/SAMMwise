# 🌍 Sistema de Internacionalização (i18n)

Este documento descreve o sistema de internacionalização implementado no SAMMwise.

## 📋 Visão Geral

O SAMMwise agora suporta múltiplos idiomas usando `next-intl`, uma biblioteca moderna e eficiente para Next.js 14.

### Idiomas Suportados

- 🇺🇸 **Inglês (en)** - Idioma padrão
- 🇧🇷 **Português (pt)** - Português Brasileiro

## 🏗️ Arquitetura

### Estrutura de Arquivos

```
sammwise/
├── messages/
│   ├── en.json              # Traduções em inglês
│   └── pt.json              # Traduções em português
├── i18n.js                  # Configuração do i18n
├── middleware.js            # Middleware para detecção de locale
├── comps/
│   └── LanguageSwitcher.js  # Componente seletor de idioma
└── styles/
    └── LanguageSwitcher.module.css  # Estilos do seletor
```

### Componentes Principais

#### 1. Arquivos de Tradução (`messages/*.json`)

Estrutura hierárquica de traduções:

```json
{
  "nav": {
    "home": "Início",
    "assessment": "Avaliação",
    "results": "Resultados"
  },
  "home": {
    "title": "SAMMwise",
    "description": "..."
  }
}
```

#### 2. Configuração (`i18n.js`)

Define os locales suportados e carrega as mensagens:

```javascript
export const locales = ['en', 'pt'];
export const defaultLocale = 'en';
```

#### 3. Middleware (`middleware.js`)

Detecta automaticamente o idioma preferido do usuário e redireciona quando necessário.

#### 4. Language Switcher

Componente visual para trocar entre idiomas, localizado no navbar.

## 🎯 Como Usar

### Em Componentes React

```javascript
import { useTranslations } from 'next-intl';

function MyComponent() {
  const t = useTranslations('home');
  
  return <h1>{t('title')}</h1>;
}
```

### Em Páginas (Pages Router)

```javascript
// Para páginas estáticas (SSG)
export async function getStaticProps({ locale }) {
  return {
    props: {
      messages: (await import(`../messages/${locale || 'en'}.json`)).default
    }
  };
}

// Para páginas dinâmicas (SSR)
export async function getServerSideProps({ locale }) {
  return {
    props: {
      messages: (await import(`../messages/${locale || 'en'}.json`)).default
    }
  };
}
```

### Traduções Aninhadas

```javascript
// messages/en.json
{
  "features": {
    "feature1": "First feature",
    "feature2": "Second feature"
  }
}

// No componente
const t = useTranslations('features');
<p>{t('feature1')}</p>
```

### Traduções com Parâmetros

```javascript
// messages/en.json
{
  "welcome": "Welcome, {name}!"
}

// No componente
<p>{t('welcome', { name: 'João' })}</p>
// Resultado: "Welcome, João!"
```

## 🔧 Adicionando Novo Idioma

### 1. Criar arquivo de traduções

```bash
# Criar novo arquivo
touch messages/es.json  # Espanhol, por exemplo
```

### 2. Copiar estrutura e traduzir

```json
{
  "nav": {
    "home": "Inicio",
    "assessment": "Evaluación",
    "results": "Resultados",
    "about": "Acerca de"
  },
  ...
}
```

### 3. Atualizar configuração

```javascript
// i18n.js
export const locales = ['en', 'pt', 'es'];  // Adicionar 'es'
```

### 4. Adicionar flag no LanguageSwitcher

```javascript
// comps/LanguageSwitcher.js
const languages = [
  { code: 'en', name: 'English', flag: '🇺🇸' },
  { code: 'pt', name: 'Português', flag: '🇧🇷' },
  { code: 'es', name: 'Español', flag: '🇪🇸' }  // Novo idioma
];
```

## 📝 Estrutura de Traduções

### Namespaces Principais

| Namespace | Descrição | Uso |
|-----------|-----------|-----|
| `nav` | Menu de navegação | Navbar links |
| `home` | Página inicial | Conteúdo principal |
| `assessment` | Página de avaliação | Labels e botões |
| `results` | Página de resultados | Gráficos e labels |
| `footer` | Rodapé | Copyright e links |
| `meta` | SEO metadata | Títulos e descrições |
| `practices` | Práticas SAMM | Nomes das práticas |
| `buttons` | Botões genéricos | Ações comuns |
| `errors` | Mensagens de erro | Erros e avisos |

### Exemplo Completo

```javascript
// Componente Assessment
import { useTranslations } from 'next-intl';

function Assessment() {
  const t = useTranslations('assessment');
  const tMeta = useTranslations('meta');
  const tButtons = useTranslations('buttons');
  
  return (
    <>
      <Head>
        <title>{tMeta('assessmentTitle')}</title>
      </Head>
      <h1>{t('title')}</h1>
      <button>{tButtons('save')}</button>
    </>
  );
}
```

## 🎨 Componente Language Switcher

### Features

- **Dropdown elegante** com animações suaves
- **Persistência** no localStorage
- **Indicador visual** do idioma atual
- **Responsivo** para mobile e desktop
- **Acessível** com ARIA labels

### Customização

```css
/* styles/LanguageSwitcher.module.css */
.currentLanguage {
  /* Personalizar botão principal */
}

.dropdown {
  /* Personalizar dropdown */
}
```

## 🔍 Detecção de Idioma

### Ordem de Prioridade

1. **localStorage** - Preferência salva do usuário
2. **URL** - Locale na URL (`/pt/about`)
3. **Browser** - Accept-Language header
4. **Default** - Inglês (fallback)

### Persistência

O idioma selecionado é salvo automaticamente:

```javascript
// Salvo no localStorage
localStorage.setItem('locale', 'pt');

// Recuperado automaticamente
const savedLocale = localStorage.getItem('locale');
```

## 🧪 Testando Traduções

### 1. Teste Manual

1. Abra a aplicação
2. Clique no seletor de idioma no navbar
3. Selecione um idioma diferente
4. Navegue pelas páginas
5. Verifique se todas as traduções aparecem corretamente

### 2. Teste de Fallback

```javascript
// Se uma chave não existir, mostra a chave
t('nonexistent.key')  // Exibe: "nonexistent.key"
```

### 3. Verificação de Completude

```bash
# Script para verificar traduções faltantes
node scripts/check-translations.js
```

## 📊 Performance

### Otimizações Implementadas

1. **Tree Shaking** - Apenas traduções usadas são incluídas
2. **Code Splitting** - Traduções carregadas sob demanda
3. **Static Generation** - Páginas pré-renderizadas com traduções
4. **No Runtime Overhead** - Zero JavaScript adicional no cliente

### Bundle Size

| Idioma | Tamanho | Impacto |
|--------|---------|---------|
| English | ~2KB | Baseline |
| Português | ~2.2KB | +200B |
| **Total** | ~4.2KB | Mínimo |

## 🐛 Troubleshooting

### Erro: "Missing message"

**Causa**: Chave de tradução não encontrada

**Solução**:
1. Verificar se a chave existe em `messages/*.json`
2. Verificar o namespace correto
3. Adicionar a tradução faltante

### Erro: "Locale not found"

**Causa**: Locale não configurado

**Solução**:
1. Adicionar locale em `i18n.js`
2. Criar arquivo `messages/{locale}.json`
3. Reiniciar o servidor

### Traduções não aparecem

**Verificar**:
1. `getStaticProps` ou `getServerSideProps` está exportando messages
2. `NextIntlClientProvider` está envolvendo a aplicação
3. `useTranslations` está sendo usado corretamente

## 📱 Suporte Mobile

O seletor de idioma é totalmente responsivo:

```css
@media (max-width: 768px) {
  .currentLanguage {
    padding: 8px 12px;
    font-size: 13px;
  }
}
```

## 🔐 Segurança

- Nenhuma informação sensível nas traduções
- Validação de locale no middleware
- Sanitização de inputs do usuário

## 🚀 Próximos Passos

### Features Planejadas

- [ ] Adicionar Espanhol (es)
- [ ] Adicionar Francês (fr)
- [ ] Tradução dinâmica de surveys completos
- [ ] RTL support (Árabe, Hebraico)
- [ ] Plural rules
- [ ] Date/Number formatting por locale
- [ ] Export de traduções para CSV
- [ ] Import de traduções de CSV
- [ ] Interface de gerenciamento de traduções

## 📚 Recursos

- **next-intl**: https://next-intl-docs.vercel.app/
- **SAMM Translations**: Contribua com traduções oficiais do SAMM
- **ICU Message Format**: https://unicode-org.github.io/icu/userguide/format_parse/messages/

## 🤝 Contribuindo com Traduções

### Como Contribuir

1. Fork o repositório
2. Crie um novo arquivo `messages/{locale}.json`
3. Traduza todas as chaves mantendo a estrutura
4. Teste localmente
5. Envie um Pull Request

### Guidelines

- Manter tom profissional
- Respeitar terminologia SAMM oficial
- Testar em contexto real
- Incluir descrição das mudanças

## 📞 Suporte

Problemas com i18n?
- 🐛 Issues: [GitHub Issues](https://github.com/owaspsamm/sammwise/issues)
- 💬 Discussões: [OWASP Slack](https://owasp.org/slack/invite)

---

**Última atualização**: Outubro 2025  
**Versão**: 2.0.0

